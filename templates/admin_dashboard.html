<!DOCTYPE html> 
<html>
<head>
    <meta charset="UTF-8">
    <title>Admin Dashboard</title>
</head>
<body>

    <form method="get" action="{{ url_for('admin.search') }}">
        <input type="text" name="q" placeholder="Search users or spot ID" required>
        <button type="submit">Search</button>
    </form>

    <h2>Admin Dashboard</h2>

    <a href="{{ url_for('admin.create_lot') }}">+ Add Parking Lot</a><br>
    <a href="{{ url_for('admin.all_reservations') }}">View All Reservations</a>

    <h3>Parking Lots</h3>
    {% for lot in lots %}
        <div>
            <strong>{{ lot.name }}</strong> - â‚¹{{ lot.price_per_hour }}/hr ({{ lot.address }}) | PIN: {{ lot.pincode }}<br>
            Total Spots: {{ lot.max_spots }} |
            Occupied: {{ lot.spots|selectattr('status', 'equalto', 'O')|list|length }} |
            Available: {{ lot.spots|selectattr('status', 'equalto', 'A')|list|length }}<br>
            <a href="{{ url_for('admin.delete_lot', lot_id=lot.id) }}">Delete</a>
        </div>
    {% endfor %}

    <h3>Parking Spot Summary</h3>
    <canvas id="spotChart" width="400" height="200"></canvas>

    <h3>Users</h3>
    <ul>
    {% for user in users %}
        <li>{{ user.full_name }} ({{ user.email }})</li>
    {% endfor %}
    </ul>

    <!-- Include Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- Chart Script -->
    <script>
        const ctx = document.getElementById('spotChart').getContext('2d');
        new Chart(ctx, {
            type: 'doughnut',
            data: {
                labels: ['Occupied', 'Available'],
                datasets: [{
                    label: 'Parking Spots',
                    data: [{{ occupied }}, {{ available }}],
                    backgroundColor: ['#f87171', '#34d399']
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: {
                        position: 'bottom'
                    }
                }
            }
        });
    </script>

</body>
</html>
